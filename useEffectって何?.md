- ステート = 値を変更すると自動的に表示が更新
- ステートが表示に使われていない場合、ステートが変更されても画面は更新されない
- 副作用フック
	- コンポーネントがマウント、更新された際に必要な作業を行えるようにする
	- 表示内容の更新もできるということ
	- `useEffect`関数を使う
	- ステートフック同様、幾つでも作成することができる
	- ==`useEffect()`==の中には複数のステートフックを記述することができるの？
-　コンポーネントが==レンダリングされた後に、useEffectが実行される==

# App_useEffect.tsx 処理フロー

## コンポーネント構成

```
App_useEffect (親)
  └── AlertMessage (子) - propsでmsgを受け取り表示
```

## State定義

| State名 | 初期値 | 役割 |
|---------|--------|------|
| `val` | `0` | 入力された数値を保持 |
| `msg` | `"set a number..."` | 計算結果メッセージを保持 |

---

## 処理フロー

### 1. 初期レンダリング時

```
[マウント開始]
    │
    ▼
┌─────────────────────────────────────┐
│ useState実行                         │
│   val = 0                           │
│   msg = "set a number..."           │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ JSXレンダリング（初回）               │
│   AlertMessage に msg を渡す         │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ useEffect実行（レンダリング後）       │
│   total = 0 (0までの合計)            │
│   setMsg("total:0.")                │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ 再レンダリング                       │
│   msg = "total:0."                  │
│   AlertMessage が更新表示            │
└─────────────────────────────────────┘
```

### 2. ユーザーが数値を入力した時（例：5を入力）

```
[input onChange発火]
    │
    ▼
┌─────────────────────────────────────┐
│ doChange関数実行                     │
│   event.target.value = "5"          │
│   setVal(5)  ← val: 0 → 5           │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ 再レンダリング                       │
│   val = 5                           │
│   msg = "total:0." (まだ古い値)      │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ useEffect実行                        │
│   for(i=0; i<=5; i++) total += i    │
│   total = 0+1+2+3+4+5 = 15          │
│   setMsg("total:15.")               │
│   msg: "total:0." → "total:15."     │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ 再レンダリング                       │
│   msg = "total:15."                 │
│   AlertMessage が更新表示            │
└─────────────────────────────────────┘
```

---

## データフロー図

```
┌──────────────────────────────────────────────────────────┐
│                    App_useEffect                         │
│                                                          │
│   ┌─────────┐    onChange     ┌─────────────────────┐   │
│   │ <input> │ ──────────────► │ doChange()          │   │
│   └─────────┘                 │   setVal(新しい値)   │   │
│                               └──────────┬──────────┘   │
│                                          │              │
│                                          ▼              │
│                               ┌─────────────────────┐   │
│                               │ val State更新       │   │
│                               │ (再レンダリング)     │   │
│                               └──────────┬──────────┘   │
│                                          │              │
│                                          ▼              │
│                               ┌─────────────────────┐   │
│                               │ useEffect()         │   │
│                               │   total計算         │   │
│                               │   setMsg(結果)      │   │
│                               └──────────┬──────────┘   │
│                                          │              │
│                                          ▼              │
│                               ┌─────────────────────┐   │
│                               │ msg State更新       │   │
│                               │ (再レンダリング)     │   │
│                               └──────────┬──────────┘   │
│                                          │              │
│                                          ▼              │
│                               ┌─────────────────────┐   │
│                               │ AlertMessage        │   │
│                               │   props.msg表示     │   │
│                               └─────────────────────┘   │
└──────────────────────────────────────────────────────────┘
```

---

## 注意点

このコードの`useEffect`には**依存配列が指定されていない**ため、**毎回のレンダリング後**に実行されます。

```tsx
useEffect(() => {
    // 依存配列なし → 毎回実行
})
```

これにより、`setMsg`が呼ばれるたびに再レンダリングが発生し、再度`useEffect`が実行されます。ただし、同じ`total`値であれば`msg`も同じになるため、Reactの最適化により無限ループにはなりません。

### 推奨される書き方

`val`が変わった時だけ実行するよう、依存配列を指定するのがベストプラクティスです：

```tsx
useEffect(() => {
    let total = 0;
    for (let i = 0; i <= val; i++) {
        total += i;
    }
    setMsg("total:" + total + ".");
}, [val]);  // valが変わった時だけ実行
```